# Dockerfile for Windows Containers
# Build: docker build -f Dockerfile.windows -t weigh-agent:windows .
# Run: docker run -it --rm weigh-agent:windows

FROM mcr.microsoft.com/windows/servercore:ltsc2022

# Install Python
RUN powershell -Command \
    $ProgressPreference = 'SilentlyContinue'; \
    Invoke-WebRequest -Uri 'https://www.python.org/ftp/python/3.11.0/python-3.11.0-amd64.exe' -OutFile 'python-installer.exe'; \
    .\python-installer.exe /quiet InstallAllUsers=1 PrependPath=1; \
    Remove-Item python-installer.exe

# Set working directory
WORKDIR /app

# Copy requirements
COPY requirements.txt .

# Install Python dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy agent files
COPY agent.py .
COPY config.json .
COPY service_wrapper.py .

# Create logs directory
RUN powershell -Command New-Item -ItemType Directory -Path logs -Force

# Set environment variables
ENV PYTHONUNBUFFERED=1

# Run agent
CMD ["python", "agent.py"]

